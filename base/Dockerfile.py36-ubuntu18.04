# Ubuntu 18.04 comes with Python 3.6
FROM ubuntu:18.04

MAINTAINER floyd@savvihub.com

ENV DEBIAN_FRONTEND=noninteractive \
	PYTHONUNBUFFERED=1 \
    PATH=/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin \
    LANG=C.UTF-8

USER root

RUN apt-get update && apt-get install -y --no-install-recommends apt-utils
RUN apt-get install -y \
        ca-certificates curl \
        gcc g++ git-core \
        libgeos-dev libgeos++-dev libmpdec2 libproj-dev libssl-dev \
        mime-support \
        proj-bin python3 python3-pip \
        sudo \
        vim-tiny \
        unzip \
        zip \
        wget && \
    apt-get clean && \
    rm -rf /var/lib/apt/lists/

RUN apt-get update && \
  	apt-get upgrade -y && \
  	apt-get install -y git

RUN git clone --depth=1 https://github.com/Bash-it/bash-it.git ~/.bash_it && \
  	bash ~/.bash_it/install.sh --silent

RUN curl -sL https://deb.nodesource.com/setup_12.x | bash - && \
  	apt-get install -y nodejs  && \
  	rm -rf /var/lib/apt/lists/*

RUN curl https://bootstrap.pypa.io/get-pip.py | python3 && \
  	pip install --upgrade pip && \
  	pip install --upgrade Cython numpy

RUN pip install --upgrade \
		jupyterlab==1.2.6 \
		ipywidgets \
		plotly \
		bokeh \
		scipy \
		numexpr \
		patsy \
		scikit-learn \
		scikit-image \
		matplotlib \
		ipython \
		pandas \
		sympy \
		seaborn \
		nose \
		jupyterlab-git \
		Cartopy==0.16 \
		cvxpy \
		h5py \
		ipywidgets \
		networkx \
		numexpr \
		pillow \
		pygments \
		tqdm && \
  	jupyter labextension install \
		@jupyterlab/git \
		jupyterlab_tensorboard \
	    @mflevine/jupyterlab_html \
		jupyterlab-spreadsheet

RUN npm i @jupyterlab/toc-extension

ARG NB_USER="savvi"
ENV SHELL=/bin/bash
ENV HOME=/home/$NB_USER
WORKDIR $HOME
ENV PATH=$HOME/.local/bin:$PATH

RUN mkdir /home/$NB_USER/work

COPY start-notebook.sh /usr/local/bin/
COPY config/ /root/.jupyter/
